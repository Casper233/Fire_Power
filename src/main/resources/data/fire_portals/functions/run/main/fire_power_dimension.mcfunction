# If there's an entity in the portal, load the other dimension to check if there's a portal
execute as @e[type=armor_stand,tag=wabportals_aether_portal_stand,predicate=fire_portals:dimensions/overworld] at @s if entity @e[predicate=fire_portals:travellers/all_mobs,distance=..0.5,scores={fire_portals_cooldown=0}] as @e[type=marker,tag=fire_portals_fire_power_dimension_marker,sort=nearest,limit=1] in fire_power:fire_power_dimension run forceload add ~5 ~5 ~-5 ~-5
execute as @e[type=armor_stand,tag=wabportals_aether_portal_stand,predicate=fire_portals:dimensions/fire_power_dimension] at @s if entity @e[predicate=fire_portals:travellers/all_mobs,distance=..0.5,scores={fire_portals_cooldown=0}] as @e[type=marker,tag=fire_portals_fire_power_dimension_marker,sort=nearest,limit=1] in minecraft:overworld run forceload add ~5 ~5 ~-5 ~-5

# If there is a portal in the other dimension, tp the player
execute as @e[type=armor_stand,tag=wabportals_aether_portal_stand,predicate=fire_portals:dimensions/overworld] at @s if entity @e[predicate=fire_portals:travellers/all_mobs,distance=..0.5,scores={fire_portals_cooldown=0}] as @e[type=marker,sort=nearest,limit=1,tag=fire_portals_fire_power_dimension_marker] at @s in fire_power:fire_power_dimension if entity @e[type=marker,tag=fire_portals_fire_power_dimension_marker,predicate=fire_portals:dimensions/fire_power_dimension,distance=..384] in minecraft:overworld as @e[predicate=fire_portals:travellers/all_mobs,predicate=fire_portals:dimensions/overworld,distance=...5,scores={fire_portals_cooldown=0}] at @s run function fire_portals:run/teleport/fire_power_dimension/dim1
execute as @e[type=armor_stand,tag=wabportals_aether_portal_stand,predicate=fire_portals:dimensions/fire_power_dimension] at @s if entity @e[predicate=fire_portals:travellers/all_mobs,distance=..0.5,scores={fire_portals_cooldown=0}] as @e[type=marker,sort=nearest,limit=1,tag=fire_portals_fire_power_dimension_marker] at @s in minecraft:overworld if entity @e[type=marker,tag=fire_portals_fire_power_dimension_marker,predicate=fire_portals:dimensions/overworld,distance=..384] in fire_power:fire_power_dimension as @e[predicate=fire_portals:travellers/all_mobs,predicate=fire_portals:dimensions/fire_power_dimension,distance=...5,scores={fire_portals_cooldown=0}] at @s run function fire_portals:run/teleport/fire_power_dimension/dim2

# Make a portal if there isn't one
execute as @e[type=armor_stand,tag=wabportals_aether_portal_stand,predicate=fire_portals:dimensions/overworld] at @s if entity @e[predicate=fire_portals:travellers/all_mobs,distance=..0.5,scores={fire_portals_cooldown=0}] as @e[type=marker,sort=nearest,limit=1,tag=fire_portals_fire_power_dimension_marker] at @s in fire_power:fire_power_dimension unless entity @e[type=marker,tag=fire_portals_fire_power_dimension_marker,predicate=fire_portals:dimensions/fire_power_dimension,distance=..384] align xyz run function fire_portals:run/create_alternate/fire_power_dimension/dim1
execute as @e[type=armor_stand,tag=wabportals_aether_portal_stand,predicate=fire_portals:dimensions/fire_power_dimension] at @s if entity @e[predicate=fire_portals:travellers/all_mobs,distance=..0.5,scores={fire_portals_cooldown=0}] as @e[type=marker,sort=nearest,limit=1,tag=fire_portals_fire_power_dimension_marker] at @s in minecraft:overworld unless entity @e[type=marker,tag=fire_portals_fire_power_dimension_marker,predicate=fire_portals:dimensions/overworld,distance=..384] align xyz run function fire_portals:run/create_alternate/fire_power_dimension/dim2

# Check if any portals got broken, and if so, close them.
execute as @e[type=marker,tag=fire_portals_fire_power_dimension_marker_z] at @s run function fire_portals:run/check_if_broken/fire_power_dimension/z
execute as @e[type=marker,tag=fire_portals_fire_power_dimension_marker_x] at @s run function fire_portals:run/check_if_broken/fire_power_dimension/x
